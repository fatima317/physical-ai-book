import React, { useState } from 'react';
import styles from './styles.module.css';

const IsaacSimPlayground = () => {
  const [code, setCode] = useState(`import omni
from omni.isaac.core import World
from omni.isaac.core.utils.stage import add_reference_to_stage
from omni.isaac.sensor import Camera
from omni.isaac.core.utils.prims import create_prim
import numpy as np

# Create a new world
world = World(stage_units_in_meters=1.0)

# Add a ground plane
add_reference_to_stage(
    usd_path="/Isaac/Environments/Simple_Room/simple_room.usd",
    prim_path="/World/simple_room"
)

# Add a camera to the scene
camera = Camera(
    prim_path="/World/Camera",
    position=np.array([0, -3, 1]),
    frequency=20,
    resolution=(640, 480)
)
camera.initialize()

# Add a simple cube
cube = create_prim(
    prim_path="/World/Cube",
    prim_type="Cube",
    position=np.array([0, 0, 1]),
    scale=np.array([0.2, 0.2, 0.2])
)

# Reset the world
world.reset()

# Step the world once to initialize
world.step(render=True)

print("Isaac Sim environment initialized successfully!")
print("Camera position:", camera.get_world_pose()[0])
print("Environment ready for perception tasks")`);

  const [output, setOutput] = useState('');
  const [isRunning, setIsRunning] = useState(false);
  const [executionResult, setExecutionResult] = useState(null);
  const [selectedExample, setSelectedExample] = useState('basic_scene');

  const examples = {
    basic_scene: {
      name: 'Basic Scene',
      code: `import omni
from omni.isaac.core import World
from omni.isaac.core.utils.stage import add_reference_to_stage
from omni.isaac.sensor import Camera
import numpy as np

# Create a new world
world = World(stage_units_in_meters=1.0)

# Add a simple environment
add_reference_to_stage(
    usd_path="/Isaac/Environments/Simple_Room/simple_room.usd",
    prim_path="/World/simple_room"
)

# Add a camera to the scene
camera = Camera(
    prim_path="/World/Camera",
    position=np.array([0, -3, 1]),
    frequency=20,
    resolution=(640, 480)
)
camera.initialize()

# Reset the world
world.reset()

# Step the world once to initialize
world.step(render=True)

print("Isaac Sim basic scene initialized successfully!")`
    },
    perception_scene: {
      name: 'Perception Scene',
      code: `import omni
from omni.isaac.core import World
from omni.isaac.core.utils.stage import add_reference_to_stage
from omni.isaac.sensor import Camera
from omni.isaac.core.utils.prims import create_prim
import numpy as np

# Create a new world
world = World(stage_units_in_meters=1.0)

# Add environment
add_reference_to_stage(
    usd_path="/Isaac/Environments/Simple_Room/simple_room.usd",
    prim_path="/World/simple_room"
)

# Add RGB camera
rgb_camera = Camera(
    prim_path="/World/RGB_Camera",
    position=np.array([0, -2, 1]),
    frequency=30,
    resolution=(640, 480)
)
rgb_camera.initialize()

# Add depth camera
depth_camera = Camera(
    prim_path="/World/Depth_Camera",
    position=np.array([0, -2, 1]),
    frequency=30,
    resolution=(640, 480)
)
depth_camera.initialize()

# Add objects for perception
cube = create_prim(
    prim_path="/World/Cube",
    prim_type="Cube",
    position=np.array([-0.5, 0, 0.5]),
    scale=np.array([0.2, 0.2, 0.2])
)

sphere = create_prim(
    prim_path="/World/Sphere",
    prim_type="Sphere",
    position=np.array([0.5, 0, 0.5]),
    scale=np.array([0.2, 0.2, 0.2])
)

# Reset the world
world.reset()

# Capture initial data
rgb_data = rgb_camera.get_rgb()
depth_data = depth_camera.get_depth()

print("Perception scene ready!")
print("RGB shape:", rgb_data.shape if rgb_data is not None else "None")
print("Depth shape:", depth_data.shape if depth_data is not None else "None")`
    },
    synthetic_data: {
      name: 'Synthetic Data Generation',
      code: `import omni
from omni.isaac.core import World
from omni.isaac.synthetic_utils import SyntheticDataGeneration
from omni.isaac.core.utils.stage import add_reference_to_stage
from omni.isaac.sensor import Camera
import numpy as np

# Create a new world
world = World(stage_units_in_meters=1.0)

# Add environment
add_reference_to_stage(
    usd_path="/Isaac/Environments/Simple_Room/simple_room.usd",
    prim_path="/World/simple_room"
)

# Add camera for synthetic data
camera = Camera(
    prim_path="/World/Data_Camera",
    position=np.array([0, -2, 1]),
    frequency=10,
    resolution=(640, 480)
)
camera.initialize()

# Setup synthetic data generation
synthetic_data_gen = SyntheticDataGeneration(
    output_dir="./synthetic_data",
    num_samples=100,
    domain_randomization=True
)

# Configure annotations to generate
synthetic_data_gen.set_output_annotations([
    "rgb",
    "depth",
    "bounding_box_2d_tight",
    "semantic_segmentation"
])

print("Synthetic data generation setup complete!")
print("Ready to generate labeled training data for computer vision tasks")`
    }
  };

  const handleRunCode = async () => {
    setIsRunning(true);
    setOutput('Initializing Isaac Sim environment...\n');

    // Simulate Isaac Sim execution with realistic output
    setTimeout(() => {
      const simulatedOutput = `Isaac Sim environment initialized successfully
USD stage created: /Isaac/Environments/Simple_Room/simple_room.usd
Camera initialized: RGB (640x480), 30Hz
Objects added: Cube, Sphere
Physics engine: PhysX
Renderer: RTX
Synthetic data generation: ENABLED
Domain randomization: ENABLED
Environment ready for perception tasks
Simulation time: 0.00s
Real-time factor: 1.00x`;

      setOutput(simulatedOutput);
      setExecutionResult({ success: true, message: 'Isaac Sim simulation executed successfully!' });
      setIsRunning(false);
    }, 3000);
  };

  const handleStopCode = () => {
    setIsRunning(false);
    setOutput(prev => prev + '\n[Simulation stopped by user]');
    setExecutionResult(null);
  };

  const handleExampleChange = (exampleKey) => {
    setSelectedExample(exampleKey);
    setCode(examples[exampleKey].code);
    setOutput('');
    setExecutionResult(null);
  };

  const handleCodeChange = (e) => {
    setCode(e.target.value);
  };

  return (
    <div className={styles.playgroundContainer}>
      <div className={styles.playgroundHeader}>
        <h2>Isaac Sim Interactive Playground</h2>
        <p>Design and simulate perception systems using Isaac Sim. Create synthetic data for computer vision tasks.</p>
      </div>

      <div className={styles.playgroundControls}>
        <div className={styles.exampleSelector}>
          <label htmlFor="isaac-example-select">Choose an example:</label>
          <select
            id="isaac-example-select"
            value={selectedExample}
            onChange={(e) => handleExampleChange(e.target.value)}
            className={styles.exampleSelect}
          >
            {Object.entries(examples).map(([key, example]) => (
              <option key={key} value={key}>{example.name}</option>
            ))}
          </select>
        </div>

        <div className={styles.executionControls}>
          <button
            onClick={handleRunCode}
            disabled={isRunning}
            className={`${styles.runButton} ${isRunning ? styles.running : ''}`}
          >
            {isRunning ? 'Running...' : 'Run Simulation'}
          </button>

          {isRunning && (
            <button
              onClick={handleStopCode}
              className={styles.stopButton}
            >
              Stop
            </button>
          )}
        </div>
      </div>

      <div className={styles.codeEditor}>
        <textarea
          value={code}
          onChange={handleCodeChange}
          className={styles.codeTextarea}
          spellCheck="false"
        />
      </div>

      <div className={styles.outputPanel}>
        <h3>Simulation Output</h3>
        <div className={styles.outputContent}>
          <pre>{output}</pre>
        </div>

        {executionResult && (
          <div className={`${styles.executionResult} ${executionResult.success ? styles.success : styles.error}`}>
            {executionResult.message}
          </div>
        )}
      </div>

      <div className={styles.conceptExplainer}>
        <h3>Isaac Sim Concepts Demonstrated</h3>
        <ul>
          <li><strong>USD (Universal Scene Description):</strong> Scalable scene representation format</li>
          <li><strong>Photorealistic Rendering:</strong> RTX-accelerated rendering for synthetic data</li>
          <li><strong>Sensor Simulation:</strong> RGB, depth, LIDAR, and other sensor types</li>
          <li><strong>Synthetic Data Generation:</strong> Automatic annotation for training datasets</li>
          <li><strong>Domain Randomization:</strong> Techniques to improve model generalization</li>
          <li><strong>Perception Pipelines:</strong> Integration with computer vision workflows</li>
        </ul>
      </div>

      <div className={styles.learningResources}>
        <h3>Learning Resources</h3>
        <ul>
          <li><a href="#" target="_blank" rel="noopener noreferrer">Isaac Sim Documentation</a></li>
          <li><a href="#" target="_blank" rel="noopener noreferrer">Omniverse Platform</a></li>
          <li><a href="#" target="_blank" rel="noopener noreferrer">Synthetic Data Generation Guide</a></li>
        </ul>
      </div>
    </div>
  );
};

export default IsaacSimPlayground;