import React, { useState } from 'react';
import styles from './styles.module.css';

const GazeboPlayground = () => {
  const [worldCode, setWorldCode] = useState(`<?xml version="1.0" ?>
<sdf version="1.7">
  <world name="playground_world">
    <!-- Physics configuration -->
    <physics name="1ms" type="ode">
      <max_step_size>0.001</max_step_size>
      <real_time_factor>1.0</real_time_factor>
    </physics>

    <!-- Ground plane -->
    <include>
      <uri>model://ground_plane</uri>
    </include>

    <!-- Sun light -->
    <include>
      <uri>model://sun</uri>
    </include>

    <!-- Simple robot model -->
    <model name="simple_robot">
      <pose>0 0 0.5 0 0 0</pose>
      <link name="chassis">
        <inertial>
          <mass>1.0</mass>
          <inertia>
            <ixx>0.083</ixx>
            <ixy>0.0</ixy>
            <ixz>0.0</ixz>
            <iyy>0.083</iyy>
            <iyz>0.0</iyz>
            <izz>0.083</izz>
          </inertia>
        </inertial>
        <visual name="visual">
          <geometry>
            <box>
              <size>0.5 0.5 0.2</size>
            </box>
          </geometry>
          <material>
            <ambient>0.2 0.2 1 1</ambient>
            <diffuse>0.2 0.2 1 1</diffuse>
          </material>
        </visual>
        <collision name="collision">
          <geometry>
            <box>
              <size>0.5 0.5 0.2</size>
            </box>
          </geometry>
        </collision>
      </link>
    </model>
  </world>
</sdf>`);

  const [output, setOutput] = useState('');
  const [isRunning, setIsRunning] = useState(false);
  const [executionResult, setExecutionResult] = useState(null);
  const [selectedExample, setSelectedExample] = useState('basic_world');

  const examples = {
    basic_world: {
      name: 'Basic World',
      code: `<?xml version="1.0" ?>
<sdf version="1.7">
  <world name="basic_world">
    <physics name="1ms" type="ode">
      <max_step_size>0.001</max_step_size>
      <real_time_factor>1.0</real_time_factor>
    </physics>

    <include>
      <uri>model://ground_plane</uri>
    </include>

    <include>
      <uri>model://sun</uri>
    </include>
  </world>`
    },
    robot_world: {
      name: 'Robot World',
      code: `<?xml version="1.0" ?>
<sdf version="1.7">
  <world name="robot_world">
    <physics name="1ms" type="ode">
      <max_step_size>0.001</max_step_size>
      <real_time_factor>1.0</real_time_factor>
    </physics>

    <include>
      <uri>model://ground_plane</uri>
    </include>

    <include>
      <uri>model://sun</uri>
    </include>

    <model name="simple_robot">
      <pose>0 0 0.5 0 0 0</pose>
      <link name="chassis">
        <inertial>
          <mass>1.0</mass>
          <inertia>
            <ixx>0.083</ixx>
            <ixy>0.0</ixy>
            <ixz>0.0</ixz>
            <iyy>0.083</iyy>
            <iyz>0.0</iyz>
            <izz>0.083</izz>
          </inertia>
        </inertial>
        <visual name="visual">
          <geometry>
            <box>
              <size>0.5 0.5 0.2</size>
            </box>
          </geometry>
          <material>
            <ambient>0.2 0.2 1 1</ambient>
            <diffuse>0.2 0.2 1 1</diffuse>
          </material>
        </visual>
        <collision name="collision">
          <geometry>
            <box>
              <size>0.5 0.5 0.2</size>
            </box>
          </geometry>
        </collision>
      </link>
    </model>
  </world>`
    },
    sensor_robot: {
      name: 'Robot with Sensors',
      code: `<?xml version="1.0" ?>
<sdf version="1.7">
  <world name="sensor_world">
    <physics name="1ms" type="ode">
      <max_step_size>0.001</max_step_size>
      <real_time_factor>1.0</real_time_factor>
    </physics>

    <include>
      <uri>model://ground_plane</uri>
    </include>

    <include>
      <uri>model://sun</uri>
    </include>

    <model name="robot_with_sensors">
      <pose>0 0 0.5 0 0 0</pose>
      <link name="chassis">
        <inertial>
          <mass>1.0</mass>
          <inertia>
            <ixx>0.083</ixx>
            <ixy>0.0</ixy>
            <ixz>0.0</ixz>
            <iyy>0.083</iyy>
            <iyz>0.0</iyz>
            <izz>0.083</izz>
          </inertia>
        </inertial>
        <visual name="visual">
          <geometry>
            <box>
              <size>0.5 0.5 0.2</size>
            </box>
          </geometry>
          <material>
            <ambient>0.2 0.2 1 1</ambient>
            <diffuse>0.2 0.2 1 1</diffuse>
          </material>
        </visual>
        <collision name="collision">
          <geometry>
            <box>
              <size>0.5 0.5 0.2</size>
            </box>
          </geometry>
        </collision>

        <!-- RGB Camera Sensor -->
        <sensor type="camera" name="camera_sensor">
          <pose>0.2 0 0.1 0 0 0</pose>
          <update_rate>30.0</update_rate>
          <camera name="head">
            <horizontal_fov>1.3962634</horizontal_fov>
            <image>
              <width>640</width>
              <height>480</height>
              <format>R8G8B8</format>
            </image>
            <clip>
              <near>0.1</near>
              <far>100</far>
            </clip>
          </camera>
          <plugin name="camera_controller" filename="libgazebo_ros_camera.so">
            <frame_name>camera_link</frame_name>
          </plugin>
        </sensor>
      </link>
    </model>
  </world>`
    }
  };

  const handleRunCode = async () => {
    setIsRunning(true);
    setOutput('Initializing Gazebo simulation...\n');

    // Simulate Gazebo execution with realistic output
    setTimeout(() => {
      const simulatedOutput = `Gazebo simulation initialized successfully
Physics engine: ODE
Real-time factor: 1.000
World loaded: playground_world
Models loaded: 1
Sensors initialized: 1
Simulation running...
[Time: 10.00s] Robot position: (0.00, 0.00, 0.50)
Simulation completed successfully`;

      setOutput(simulatedOutput);
      setExecutionResult({ success: true, message: 'Gazebo simulation executed successfully!' });
      setIsRunning(false);
    }, 2500);
  };

  const handleStopCode = () => {
    setIsRunning(false);
    setOutput(prev => prev + '\n[Simulation stopped by user]');
    setExecutionResult(null);
  };

  const handleExampleChange = (exampleKey) => {
    setSelectedExample(exampleKey);
    setWorldCode(examples[exampleKey].code);
    setOutput('');
    setExecutionResult(null);
  };

  const handleCodeChange = (e) => {
    setWorldCode(e.target.value);
  };

  return (
    <div className={styles.playgroundContainer}>
      <div className={styles.playgroundHeader}>
        <h2>Gazebo Interactive Playground</h2>
        <p>Design and simulate robot environments using SDF (Simulation Description Format). Try different examples below.</p>
      </div>

      <div className={styles.playgroundControls}>
        <div className={styles.exampleSelector}>
          <label htmlFor="gazebo-example-select">Choose an example:</label>
          <select
            id="gazebo-example-select"
            value={selectedExample}
            onChange={(e) => handleExampleChange(e.target.value)}
            className={styles.exampleSelect}
          >
            {Object.entries(examples).map(([key, example]) => (
              <option key={key} value={key}>{example.name}</option>
            ))}
          </select>
        </div>

        <div className={styles.executionControls}>
          <button
            onClick={handleRunCode}
            disabled={isRunning}
            className={`${styles.runButton} ${isRunning ? styles.running : ''}`}
          >
            {isRunning ? 'Running...' : 'Run Simulation'}
          </button>

          {isRunning && (
            <button
              onClick={handleStopCode}
              className={styles.stopButton}
            >
              Stop
            </button>
          )}
        </div>
      </div>

      <div className={styles.codeEditor}>
        <textarea
          value={worldCode}
          onChange={handleCodeChange}
          className={styles.codeTextarea}
          spellCheck="false"
        />
      </div>

      <div className={styles.outputPanel}>
        <h3>Simulation Output</h3>
        <div className={styles.outputContent}>
          <pre>{output}</pre>
        </div>

        {executionResult && (
          <div className={`${styles.executionResult} ${executionResult.success ? styles.success : styles.error}`}>
            {executionResult.message}
          </div>
        )}
      </div>

      <div className={styles.conceptExplainer}>
        <h3>Gazebo Concepts Demonstrated</h3>
        <ul>
          <li><strong>SDF (Simulation Description Format):</strong> XML-based format for describing simulation environments</li>
          <li><strong>World Definition:</strong> Container for models, lights, and physics configuration</li>
          <li><strong>Physics Engine:</strong> Simulation of rigid body dynamics and collisions</li>
          <li><strong>Models:</strong> 3D representations of robots and objects</li>
          <li><strong>Sensors:</strong> Simulation of cameras, LIDAR, IMU, and other sensors</li>
          <li><strong>URDF Integration:</strong> Robot descriptions that can be used in Gazebo</li>
        </ul>
      </div>

      <div className={styles.learningResources}>
        <h3>Learning Resources</h3>
        <ul>
          <li><a href="#" target="_blank" rel="noopener noreferrer">Gazebo Documentation</a></li>
          <li><a href="#" target="_blank" rel="noopener noreferrer">SDF Specification</a></li>
          <li><a href="#" target="_blank" rel="noopener noreferrer">Gazebo Tutorials</a></li>
        </ul>
      </div>
    </div>
  );
};

export default GazeboPlayground;